"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),Bump=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?PIXI:arguments[0];if(_classCallCheck(this,e),void 0===t)throw new Error("Please assign a rendering engine in the constructor before using bump.js");this.renderer="",t.particles.ParticleContainer&&t.Sprite&&(this.renderer="pixi")}return _createClass(e,[{key:"addCollisionProperties",value:function(e){"pixi"===this.renderer&&(void 0===e.gx&&Object.defineProperty(e,"gx",{get:function(){return e.getGlobalPosition().x},enumerable:!0,configurable:!0}),void 0===e.gy&&Object.defineProperty(e,"gy",{get:function(){return e.getGlobalPosition().y},enumerable:!0,configurable:!0}),void 0===e.centerX&&Object.defineProperty(e,"centerX",{get:function(){return e.x+e.width/2},enumerable:!0,configurable:!0}),void 0===e.centerY&&Object.defineProperty(e,"centerY",{get:function(){return e.y+e.height/2},enumerable:!0,configurable:!0}),void 0===e.halfWidth&&Object.defineProperty(e,"halfWidth",{get:function(){return e.width/2},enumerable:!0,configurable:!0}),void 0===e.halfHeight&&Object.defineProperty(e,"halfHeight",{get:function(){return e.height/2},enumerable:!0,configurable:!0}),void 0===e.xAnchorOffset&&Object.defineProperty(e,"xAnchorOffset",{get:function(){return void 0!==e.anchor?e.height*e.anchor.x:0},enumerable:!0,configurable:!0}),void 0===e.yAnchorOffset&&Object.defineProperty(e,"yAnchorOffset",{get:function(){return void 0!==e.anchor?e.width*e.anchor.y:0},enumerable:!0,configurable:!0}),e.circular&&void 0===e.radius&&Object.defineProperty(e,"radius",{get:function(){return e.width/2},enumerable:!0,configurable:!0})),e._bumpPropertiesAdded=!0}},{key:"hitTestPoint",value:function(e,t){t._bumpPropertiesAdded||this.addCollisionProperties(t);var i=void 0,r=void 0,n=void 0,o=void 0,s=void 0,d=void 0;if(i=t.radius?"circle":"rectangle","rectangle"===i&&(r=t.x-t.xAnchorOffset,n=t.x+t.width-t.xAnchorOffset,o=t.y-t.yAnchorOffset,s=t.y+t.height-t.yAnchorOffset,d=e.x>r&&e.x<n&&e.y>o&&e.y<s),"circle"===i){var h=e.x-t.x-t.width/2+t.xAnchorOffset,a=e.y-t.y-t.height/2+t.yAnchorOffset,f=Math.sqrt(h*h+a*a);d=f<t.radius}return d}},{key:"hitTestCircle",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];e._bumpPropertiesAdded||this.addCollisionProperties(e),t._bumpPropertiesAdded||this.addCollisionProperties(t);var r=void 0,n=void 0,o=void 0,s=void 0,d=void 0;return i?(r=t.gx+t.width/2-t.xAnchorOffset-(e.gx+e.width/2-e.xAnchorOffset),n=t.gy+t.width/2-t.yAnchorOffset-(e.gy+e.width/2-e.yAnchorOffset)):(r=t.x+t.width/2-t.xAnchorOffset-(e.x+e.width/2-e.xAnchorOffset),n=t.y+t.width/2-t.yAnchorOffset-(e.y+e.width/2-e.yAnchorOffset)),o=Math.sqrt(r*r+n*n),s=e.radius+t.radius,d=s>o}},{key:"circleCollision",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],r=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];e._bumpPropertiesAdded||this.addCollisionProperties(e),t._bumpPropertiesAdded||this.addCollisionProperties(t);var n=void 0,o=void 0,s=void 0,d=void 0,h=void 0,a=void 0,f=void 0,c={},l=!1;if(r?(d=t.gx+t.width/2-t.xAnchorOffset-(e.gx+e.width/2-e.xAnchorOffset),h=t.gy+t.width/2-t.yAnchorOffset-(e.gy+e.width/2-e.yAnchorOffset)):(d=t.x+t.width/2-t.xAnchorOffset-(e.x+e.width/2-e.xAnchorOffset),h=t.y+t.width/2-t.yAnchorOffset-(e.y+e.width/2-e.yAnchorOffset)),n=Math.sqrt(d*d+h*h),o=e.radius+t.radius,o>n){l=!0,s=o-n;var u=.3;s+=u,a=d/n,f=h/n,e.x-=s*a,e.y-=s*f,i&&(c.x=h,c.y=-d,this.bounceOffSurface(e,c))}return l}},{key:"movingCircleCollision",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];e._bumpPropertiesAdded||this.addCollisionProperties(e),t._bumpPropertiesAdded||this.addCollisionProperties(t);var r=void 0,n=void 0,o=void 0,s=void 0,d={},h={},a={},f={},c={},l=!1;if(e.mass=e.mass||1,t.mass=t.mass||1,i?(d.vx=t.gx+t.radius-t.xAnchorOffset-(e.gx+e.radius-e.xAnchorOffset),d.vy=t.gy+t.radius-t.yAnchorOffset-(e.gy+e.radius-e.yAnchorOffset)):(d.vx=t.x+t.radius-t.xAnchorOffset-(e.x+e.radius-e.xAnchorOffset),d.vy=t.y+t.radius-t.yAnchorOffset-(e.y+e.radius-e.yAnchorOffset)),d.magnitude=Math.sqrt(d.vx*d.vx+d.vy*d.vy),r=e.radius+t.radius,d.magnitude<r){l=!0,n=r-d.magnitude,n+=.3,d.dx=d.vx/d.magnitude,d.dy=d.vy/d.magnitude,d.vxHalf=Math.abs(d.dx*n/2),d.vyHalf=Math.abs(d.dy*n/2),o=e.x>t.x?1:-1,s=e.y>t.y?1:-1,e.x=e.x+d.vxHalf*o,e.y=e.y+d.vyHalf*s,t.x=t.x+d.vxHalf*-o,t.y=t.y+d.vyHalf*-s,d.lx=d.vy,d.ly=-d.vx;var u=e.vx*d.dx+e.vy*d.dy;h.x=u*d.dx,h.y=u*d.dy;var g=e.vx*(d.lx/d.magnitude)+e.vy*(d.ly/d.magnitude);a.x=g*(d.lx/d.magnitude),a.y=g*(d.ly/d.magnitude);var y=t.vx*d.dx+t.vy*d.dy;f.x=y*d.dx,f.y=y*d.dy;var v=t.vx*(d.lx/d.magnitude)+t.vy*(d.ly/d.magnitude);c.x=v*(d.lx/d.magnitude),c.y=v*(d.ly/d.magnitude),e.bounce={},e.bounce.x=a.x+f.x,e.bounce.y=a.y+f.y,t.bounce={},t.bounce.x=h.x+c.x,t.bounce.y=h.y+c.y,e.vx=e.bounce.x/e.mass,e.vy=e.bounce.y/e.mass,t.vx=t.bounce.x/t.mass,t.vy=t.bounce.y/t.mass}return l}},{key:"multipleCircleCollision",value:function(e){for(var t=arguments.length<=1||void 0===arguments[1]?!1:arguments[1],i=0;i<e.length;i++)for(var r=e[i],n=i+1;n<e.length;n++){var o=e[n];this.movingCircleCollision(r,o,t)}}},{key:"rectangleCollision",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],r=arguments.length<=3||void 0===arguments[3]?!0:arguments[3];e._bumpPropertiesAdded||this.addCollisionProperties(e),t._bumpPropertiesAdded||this.addCollisionProperties(t);var n=void 0,o=void 0,s=void 0,d=void 0,h=void 0,a=void 0,f=void 0;return r?(a=e.gx+e.halfWidth-e.xAnchorOffset-(t.gx+t.halfWidth-t.xAnchorOffset),f=e.gy+e.halfHeight-e.yAnchorOffset-(t.gy+t.halfHeight-t.yAnchorOffset)):(a=e.x+e.halfWidth-e.xAnchorOffset-(t.x+t.halfWidth-t.xAnchorOffset),f=e.y+e.halfHeight-e.yAnchorOffset-(t.y+t.halfHeight-t.yAnchorOffset)),o=e.halfWidth+t.halfWidth,s=e.halfHeight+t.halfHeight,Math.abs(a)<o&&Math.abs(f)<s&&(d=o-Math.abs(a),h=s-Math.abs(f),d>=h?(f>0?(n="top",e.y=e.y+h):(n="bottom",e.y=e.y-h),i&&(e.vy*=-1)):(a>0?(n="left",e.x=e.x+d):(n="right",e.x=e.x-d),i&&(e.vx*=-1))),n}},{key:"hitTestRectangle",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];e._bumpPropertiesAdded||this.addCollisionProperties(e),t._bumpPropertiesAdded||this.addCollisionProperties(t);var r=void 0,n=void 0,o=void 0,s=void 0,d=void 0;return r=!1,i?(s=e.gx+e.halfWidth-e.xAnchorOffset-(t.gx+t.halfWidth-t.xAnchorOffset),d=e.gy+e.halfHeight-e.yAnchorOffset-(t.gy+t.halfHeight-t.yAnchorOffset)):(s=e.x+e.halfWidth-e.xAnchorOffset-(t.x+t.halfWidth-t.xAnchorOffset),d=e.y+e.halfHeight-e.yAnchorOffset-(t.y+t.halfHeight-t.yAnchorOffset)),n=e.halfWidth+t.halfWidth,o=e.halfHeight+t.halfHeight,r=Math.abs(s)<n&&Math.abs(d)<o?!0:!1}},{key:"hitTestCircleRectangle",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];t._bumpPropertiesAdded||this.addCollisionProperties(t),e._bumpPropertiesAdded||this.addCollisionProperties(e);var r=void 0,n=void 0,o=void 0,s=void 0,d=void 0,h=void 0;if(i?(o=e.gx,s=e.gy,d=t.gx,h=t.gy):(o=e.x,s=e.y,d=t.x,h=t.y),r=s-e.yAnchorOffset<h-t.halfHeight-t.yAnchorOffset?o-e.xAnchorOffset<d-1-t.halfWidth-t.xAnchorOffset?"topLeft":o-e.xAnchorOffset>d+1+t.halfWidth-t.xAnchorOffset?"topRight":"topMiddle":s-e.yAnchorOffset>h+t.halfHeight-t.yAnchorOffset?o-e.xAnchorOffset<d-1-t.halfWidth-t.xAnchorOffset?"bottomLeft":o-e.xAnchorOffset>d+1+t.halfWidth-t.xAnchorOffset?"bottomRight":"bottomMiddle":o-e.xAnchorOffset<d-t.halfWidth-t.xAnchorOffset?"leftMiddle":"rightMiddle","topMiddle"===r||"bottomMiddle"===r||"leftMiddle"===r||"rightMiddle"===r)n=this.hitTestRectangle(e,t,i);else{var a={};switch(r){case"topLeft":a.x=d-t.xAnchorOffset,a.y=h-t.yAnchorOffset;break;case"topRight":a.x=d+t.width-t.xAnchorOffset,a.y=h-t.yAnchorOffset;break;case"bottomLeft":a.x=d-t.xAnchorOffset,a.y=h+t.height-t.yAnchorOffset;break;case"bottomRight":a.x=d+t.width-t.xAnchorOffset,a.y=h+t.height-t.yAnchorOffset}n=this.hitTestCirclePoint(e,a,i)}return n?r:n}},{key:"hitTestCirclePoint",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];return e._bumpPropertiesAdded||this.addCollisionProperties(e),t.diameter=1,t.width=t.diameter,t.radius=.5,t.centerX=t.x,t.centerY=t.y,t.gx=t.x,t.gy=t.y,t.xAnchorOffset=0,t.yAnchorOffset=0,t._bumpPropertiesAdded=!0,this.hitTestCircle(e,t,i)}},{key:"circleRectangleCollision",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],r=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];t._bumpPropertiesAdded||this.addCollisionProperties(t),e._bumpPropertiesAdded||this.addCollisionProperties(e);var n=void 0,o=void 0,s=void 0,d=void 0,h=void 0,a=void 0;if(r?(s=e.gx,d=e.gy,h=t.gx,a=t.gy):(s=e.x,d=e.y,h=t.x,a=t.y),n=d-e.yAnchorOffset<a-t.halfHeight-t.yAnchorOffset?s-e.xAnchorOffset<h-1-t.halfWidth-t.xAnchorOffset?"topLeft":s-e.xAnchorOffset>h+1+t.halfWidth-t.xAnchorOffset?"topRight":"topMiddle":d-e.yAnchorOffset>a+t.halfHeight-t.yAnchorOffset?s-e.xAnchorOffset<h-1-t.halfWidth-t.xAnchorOffset?"bottomLeft":s-e.xAnchorOffset>h+1+t.halfWidth-t.xAnchorOffset?"bottomRight":"bottomMiddle":s-e.xAnchorOffset<h-t.halfWidth-t.xAnchorOffset?"leftMiddle":"rightMiddle","topMiddle"===n||"bottomMiddle"===n||"leftMiddle"===n||"rightMiddle"===n)o=this.rectangleCollision(e,t,i,r);else{var f={};switch(n){case"topLeft":f.x=h-t.xAnchorOffset,f.y=a-t.yAnchorOffset;break;case"topRight":f.x=h+t.width-t.xAnchorOffset,f.y=a-t.yAnchorOffset;break;case"bottomLeft":f.x=h-t.xAnchorOffset,f.y=a+t.height-t.yAnchorOffset;break;case"bottomRight":f.x=h+t.width-t.xAnchorOffset,f.y=a+t.height-t.yAnchorOffset}o=this.circlePointCollision(e,f,i,r)}return o?n:o}},{key:"circlePointCollision",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],r=arguments.length<=3||void 0===arguments[3]?!1:arguments[3];return e._bumpPropertiesAdded||this.addCollisionProperties(e),t.diameter=1,t.width=t.diameter,t.radius=.5,t.centerX=t.x,t.centerY=t.y,t.gx=t.x,t.gy=t.y,t.xAnchorOffset=0,t.yAnchorOffset=0,t._bumpPropertiesAdded=!0,this.circleCollision(e,t,i,r)}},{key:"bounceOffSurface",value:function(e,t){e._bumpPropertiesAdded||this.addCollisionProperties(e);var i=void 0,r=void 0,n={},o={},s={},d=e.mass||1;t.lx=t.y,t.ly=-t.x,t.magnitude=Math.sqrt(t.x*t.x+t.y*t.y),t.dx=t.x/t.magnitude,t.dy=t.y/t.magnitude,i=e.vx*t.dx+e.vy*t.dy,n.vx=i*t.dx,n.vy=i*t.dy,r=e.vx*(t.lx/t.magnitude)+e.vy*(t.ly/t.magnitude),o.vx=r*(t.lx/t.magnitude),o.vy=r*(t.ly/t.magnitude),o.vx*=-1,o.vy*=-1,s.x=n.vx+o.vx,s.y=n.vy+o.vy,e.vx=s.x/d,e.vy=s.y/d}},{key:"contain",value:function(e,t){var i=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],r=arguments.length<=3||void 0===arguments[3]?void 0:arguments[3];e._bumpPropertiesAdded||this.addCollisionProperties(e),void 0===t.xAnchorOffset&&(t.xAnchorOffset=0),void 0===t.yAnchorOffset&&(t.yAnchorOffset=0),void 0===e.parent.gx&&(e.parent.gx=0),void 0===e.parent.gy&&(e.parent.gy=0);var n=new Set;return e.x-e.xAnchorOffset<t.x-e.parent.gx-t.xAnchorOffset&&(i&&(e.vx*=-1),e.mass&&(e.vx/=e.mass),e.x=t.x-e.parent.gx-t.xAnchorOffset+e.xAnchorOffset,n.add("left")),e.y-e.yAnchorOffset<t.y-e.parent.gy-t.yAnchorOffset&&(i&&(e.vy*=-1),e.mass&&(e.vy/=e.mass),e.y=t.y-e.parent.gy-t.yAnchorOffset+e.yAnchorOffset,n.add("top")),e.x-e.xAnchorOffset+e.width>t.width-t.xAnchorOffset&&(i&&(e.vx*=-1),e.mass&&(e.vx/=e.mass),e.x=t.width-e.width-t.xAnchorOffset+e.xAnchorOffset,n.add("right")),e.y-e.yAnchorOffset+e.height>t.height-t.yAnchorOffset&&(i&&(e.vy*=-1),e.mass&&(e.vy/=e.mass),e.y=t.height-e.height-t.yAnchorOffset+e.yAnchorOffset,n.add("bottom")),0===n.size&&(n=void 0),n&&r&&r(n),n}},{key:"outsideBounds",value:function(e,t,i){var r=t.x,n=t.y,o=t.width,s=t.height,d=new Set;return e.x<r-e.width&&d.add("left"),e.y<n-e.height&&d.add("top"),e.x>o+e.width&&d.add("right"),e.y>s+e.height&&d.add("bottom"),0===d.size&&(d=void 0),d&&i&&i(d),d}},{key:"_getCenter",value:function(e,t,i){return void 0!==e.anchor?0!==e.anchor[i]?0:t/2:t}},{key:"hit",value:function(e,t){function i(e,t){var i=void 0!==e.parent,r=void 0!==t.parent;if(i&&r)return e.diameter&&t.diameter?n(e,t):e.diameter&&!t.diameter?s(e,t):o(e,t);if(r&&void 0!==e.x&&void 0!==e.y)return c(e,t);throw new Error("I'm sorry, "+e+" and "+t+" cannot be use together in a collision test.'")}function r(){if(e instanceof Array)var r=[o,n],n=r[0],o=r[1];for(var s=t.length-1;s>=0;s--){var d=t[s];A=i(e,d),A&&f&&f(A,d)}}function n(e,t){return d?e.vx+e.vy!==0&&t.vx+t.vy!==0?g(e,t,a):y(e,t,h,a):u(e,t)}function o(e,t){return d?x(e,t,h,a):l(e,t,a)}function s(e,t){return d?m(e,t,h,a):v(e,t,a)}var d=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],h=arguments.length<=3||void 0===arguments[3]?!1:arguments[3],a=arguments[4],f=arguments.length<=5||void 0===arguments[5]?void 0:arguments[5],c=this.hitTestPoint.bind(this),l=this.hitTestRectangle.bind(this),u=this.hitTestCircle.bind(this),g=this.movingCircleCollision.bind(this),y=this.circleCollision.bind(this),v=this.hitTestCircleRectangle.bind(this),x=this.rectangleCollision.bind(this),m=this.circleRectangleCollision.bind(this),A=void 0,O=void 0!==e.parent,p=void 0!==t.parent;return O&&t instanceof Array||p&&e instanceof Array?r():(A=i(e,t),A&&f&&f(A)),A}}]),e}();